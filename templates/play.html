<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Play</title>
        <style>
            #pause-btn, #stop-btn, #PlayorPause, #progressBar{
                display: none;
            }
        </style>
        <!-- 引入jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        
    </head>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,700,800,900');
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        body {
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #333;
        }

        .back-btn button{
            font-size: 20px;
            margin-top: 10px;
        }
        .container
            {
                position: relative;
                display: flex;
                padding: 80px 40px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap;
                gap: 80px;
            }
        .container1
        {
            position: relative;
            display: flex;
            padding: 40px 20px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 80px;
        }    
        .card
            {
                position: relative;
                width: 350px;
                height: 180px;
                background: #333;
                transition: 0.5s;
            }
            .card:hover
            {
                height: 450px;
            }
            .card .lines
            {
                position: absolute;
                inset: 0;
                background: #000;
                overflow: hidden;
            }
            .card .lines::before
            {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 600px;
                height: 120px;
                background: linear-gradient(transparent, #45f3ff, #45f3ff,#45f3ff,transparent);
                animation: animate 4s linear infinite;
                animation-play-state: paused;
            }
            .card:hover .lines::before
            {
                animation-play-state: running;
            }
            @keyframes animate
            {
                0%
                {
                    transform: translate(-50%, -50%) rotate(0deg);
                }
                100%
                {
                    transform: translate(-50%, -50%) rotate(360deg);
                }
            }
            .card .lines::after
            {
                content: '';
                position: absolute;
                inset: 3px;
                background: #292929;
            }
            .card .imgBx
            {
                position: absolute;
                top: -60px;
                left: 50%;
                width: 150px;
                height: 150px;
                transform: translateX(-50%);
                background: #000;
                transition: 0.5s;
                z-index: 10;
                overflow: hidden;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .card:hover .imgBx
            {
                top: 25px;
                width: 280px;
                height: 280px;
            }
            .card .imgBx::before
            {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 500px;
                height: 150px;
                transform: translate(-50%,-50%);
                background: linear-gradient(transparent, #ff3c7b, #ff3c7b,#ff3c7b,transparent);
                animation: animate2 6s linear infinite;
                animation-play-state: paused;
            }
            .card:hover .imgBx::before
            {
                animation-play-state: running;
            }
            @keyframes animate2
            {
                0%
                {
                    transform: translate(-50%, -50%) rotate(360deg);
                }
                100%
                {
                    transform: translate(-50%, -50%) rotate(0deg);
                }
            }
            .card .imgBx::after
            {
                content: '';
                position: absolute;
                inset: 3px;
                background: #292929;
            }
            .card .imgBx img
            {
                position:absolute;
                width: 100px;
                z-index: 1;
                filter: invert(1);
                opacity: 0.5;
                transition: 0.5s;
            }
            .card:hover .imgBx img
            {
                opacity: 1;
            }
            .card .content
            {
                position: absolute;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: flex-end;
                overflow: hidden;
            }
            .card .content .details
            {
                padding: 10px 10px;
                text-align: center;
                width: 100%;
                transition: 0.5s;
                transform: translateY(70px);
            }
            .card:hover .content .details
            {
                transform: translateY(0px);
            }
            h2{
                margin-bottom: 25px;
            }
            .card .content .details h2
            {
                font-size: 1.5em;
                font-weight: 500;
                color: #45f3ff;
                line-height: 1.2em;
            }
            .card .content .details p
            {
                color: #fff;
                opacity: 0;
                transition: 0.5s;
            }
            .card:hover .content .details p
            {
                opacity: 1;
            }
            .card .content .details .a
            {
                padding: 10px 2px;
            }
            .card .content .details .a .b
            {
                padding: 1px;
            }
            .card:hover .content .details p,
            .card:hover .content .details a
            {
                opacity: 1;
            }

            .header{
                background-color: #333;
                width: 100%;
                padding-top: 10px;
            }
            .box{
                background: rgb(71, 71, 73, 0.6);
                border: 5px solid transparent;
                position:fixed;
                left: 80px;
                bottom: 55px;
                padding: 15px;
                color: white;
                z-index: 10;
                }
            .border-img{
                -moz-border-image: -moz-linear-gradient(top left, #45f3ff 0%, #ff3c7b 100%);
                -webkit-border-image: -webkit-linear-gradient(top left, #45f3ff 0%, #ff3c7b 100%);
                        border-image: linear-gradient(to bottom right, #45f3ff 0%, #ff3c7b 100%);
                border-image-slice: 1;
            }

            form label{
                margin-left: 20px;
                margin-right: 10px;
            }
            
    </style>
    <body>
        <div class="container">
            <div class="header">
    
            </div>
            {% for file in media_files %}
            <div class="card">
                <div class="lines"></div>
                <div class="imgBx">
                    {% load static %}
                    <img src="{% static 'upload/play.png' %}">
                </div>
                <div class="content">
                    <div class="details">
                        <h2>
                            {{ file|slice:"7:" }}
                        </h2>
                        <form action="javascript:void(0);" method="post" class="a">
                            {% csrf_token %}
                            
                                <input type="hidden" name="file" value="{{ file }}">
                                <!-- 在下面那個按鈕，增加一個觸發事件 -->
                                
                                <label class="btn btn-info">
                                    Play
                                    <button id="playButton" onclick="playFile(this);" type="submit" name="playButton" value="{{file|slice:'7:'}}" formaction="{{ file }}/" target="_blank" style="background-color: #45f3ff; display: none;">Play</button>
                                </label>
                                
                                <label class="btn btn-info">
                                    Delete
                                    <button onclick="return confirmDelete();" type="submit" formaction="/delete/" style="background-color: #45f3ff; display: none;">Delete</button>  
                                </label>
                        </form>
                    </div>
                </div>
            </div> 
            {% endfor %}
            
        </div>
        
        <div class="container1">
            <a href="/" class="btn btn-info">Back to homepage</a>
        </div>
            
        
        <div id="message" class="box border-img" style="display: none">
            <h3 id="current_playing_file"></h3>
            <h4 id="PlayorPause"></h4>
                <button id="stop-btn" class="btn btn-info" onclick="stop_playing(event)" style="display: none;">
                        Close
                </button>
        </div>

        <script>
            var pause_count = 1;  // 暫停按鈕的次數，用來判斷是暫停還是繼續播放
            var duration = 1; //宣告duration為1，避免index >= duration，一開就被判斷為時間到，導致無法播放
            var playButton = document.getElementById("playButton"); // 取得id為play-btn的標籤
            var count = 0; // 計算暫停次數

            // 確認是否要刪除檔案，這會被用在刪除檔案的按鈕上
            function confirmDelete() {
                return confirm("You sure you want to delete it?");
            }

            // 再按播放按鈕時，顯示正在撥放的檔案名稱，並顯示暫停按鈕和停止按鈕
            function playFile(button){
                var currentFile = document.getElementById("current_playing_file"); // 取得id為current_playing_file的標籤
                var stopBtn = document.getElementById("stop-btn"); // 取得id為stop-btn的標籤
                var PlayorPause = document.getElementById("PlayorPause");// 取得id為PlayorPause的標籤
                var playButton = document.getElementById("playButton"); // 取得id為play-btn的標籤
                var mess= document.getElementById("message");

                mess.style.display= "inline";
                stopBtn.style.display = "inline"; // 顯示停止按鈕
                PlayorPause.style.display = "inline"; // 顯示播放中
                currentFile.innerHTML = "File name : " + button.value; // 把playbutton裡面的value的值，放到id為current_playing_file的標籤裡面
                PlayorPause.innerHTML = "Playing "; // 把播放中的文字改成播放中
            }

            // 停止按鈕功能
            function stop_playing(event){
                count = 0 // 暫停次數歸零
                event.preventDefault(); //  防止瀏覽器預設行為
                
                var currentFile = document.getElementById("current_playing_file"); // 取得id為current_playing_file的標籤
                var stopBtn = document.getElementById("stop-btn"); // 取得id為stop-btn的標籤
                var PlayorPause = document.getElementById("PlayorPause"); // 取得id為PlayorPause的標籤
                var playButton = document.getElementById("playButton"); // 取得id為play-btn的標籤

                stopBtn.style.display = "none"; // 隱藏停止按鈕
                PlayorPause.style.display = "none"; // 隱藏 "播放中"
                currentFile.innerHTML = "Video is closed."; // 把currentFile裡面的文字改成影片已關閉
                // 傳送停止的指令給後端
                fetch('{% url "control player" %}',{ // 傳送指令給叫control player的url
                    method: 'POST', // 使用POST方法
                    headers: { // 傳送的資料格式
                        'Content-Type': 'application/json', // json格式
                        'X-CSRFToken': '{{ csrf_token }}' // csrf_token
                    },
                    body: JSON.stringify({'action': 'Stop'}) // 傳送Stop的action給後端
                })
                    .then(response => response.json()) // 回傳的資料轉成json格式
                    .then(data => { // 回傳的資料
                        console.log(data); // 印出回傳的資料
                    })
                    .catch(error => {  // 如果有錯誤
                        console.log(error); // 印出錯誤
                    })
                    .finally(() => { // 結束後
                        stopBtn.disabled = false; // 停止按鈕可以按
                    })
            }
        </script>
    </body>
</html>
